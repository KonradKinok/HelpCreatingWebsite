<!DOCTYPE html><html lang="pl"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Raleway:wght@100;300;700&family=Roboto:wght@300;400&display=swap" rel="stylesheet"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/modern-normalize/1.0.0/modern-normalize.min.css"><link rel="stylesheet" href="/HelpCreatingWebsite/index.066807ea.css"><link rel="stylesheet" href="/HelpCreatingWebsite/htmlNode/01-podstawyNode.js.73765607.css"><title>Baza danych Mongo DB</title></head><body class="body-container"> <header class="menu-sticky"> <nav class="nav-container">  <ul id="main-menu" class="nav-list-container"></ul> <ul id="this-page-menu" class="this-page-menu"></ul> </nav> </header> <main class="main-container">  <section id="1" class="text"> <h1>Moduł 3 - Zajęcia 5 - Baza danych Mongo DB</h1> <article id="1.1"> <h2>1.1 Podstawy MongoDB</h2> <p> Współczesnej aplikacji webowej potrzebny jest nieulotny magazyn danych. Bardzo długo w tym celu wykorzystywana była prawie zawsze baza danych SQL, ale już od dłuższego czasu istnieją alternatywy w postaci baz NoSQL. </p> <p> Tego rodzaju bazy danych wzięły pod uwagę rozproszoną naturę sieci i podobnie jak Node.js, skupiły się na deserializacji i decentralizacji w celu skalowania wydajności. Przeanalizujemy jedną z najpopularniejszych, zorientowaną na dokumenty, bazę danych MongoDB. </p> <p> MongoDB jest nierelacyjną bazą danych typu NoSQL. Taka baza opiera się na modelu dokumentów (documents) - obiektów danych - przechowywanych w zbiorach nazywanych kolekcjami (collections). </p> </article> <article id="1.2"> <h3>1.2 Kolekcje i dokumenty</h3> <p> Dane w MongoDB grupują się w kolekcjach. Kolekcja to zbiór dokumentów o określonej nazwie. Kolekcja podobna jest do tabeli w bazie danych SQL, ale odróżnia się tym, że dla kolekcji nie musimy określać ścisłego schematu danych, więc poszczególne dokumenty kolekcji mogą mieć różną strukturę. </p> <p> Dokument to pojedynczy obiekt zawierający informację w bazie danych. Mogą one składać się z zagnieżdżonych obiektów i ten model danych jest bardzo wygodny dla aplikacji webowych. Maksymalny rozmiar pojedynczego dokumentu w MongoDB jest ograniczony do 16 MB. </p> <p> W Mongo DB jako język zapytań wykorzystuje się JavaScript i struktury JSON. Wybór języka zapytań nie jest zaskoczeniem, biorąc pod uwagę to, że MongoDB wykorzystuje format JSON do przedstawienia dokumentów i przesyłania wyników. </p> <p>Fizycznie struktury JSON przechowywane są w binarnym formacie BSON.</p> <div class="grow_up-img img-container"> <img src="/HelpCreatingWebsite/16-mongoDb-1.d1986f31.png" alt=""> </div> <p> Dokumenty (tj. obiekty) mogą więc zawierać dobrze nam znane typy danych z JavaScript i formatu JSON (ale nie tylko) </p> <p> W poniżej tabeli przedstawione są analogiczne koncepty i terminologia dla SQL i MongoDB. </p> <table class="table-metody-odpowiedzi"> <tr> <th>SQL</th> <th>MongoDB</th> </tr> <tr> <td>baza danych</td> <td>baza danych</td> </tr> <tr> <td>tabela</td> <td>kolekcja</td> </tr> <tr> <td>łańcuch</td> <td>dokument</td> </tr> <tr> <td>kolumna</td> <td>pole</td> </tr> <tr> <td>indeks</td> <td>indeks</td> </tr> <tr> <td>joins</td> <td>$lookup</td> </tr> </table> </article> <article id="1.3"> <h4>1.3 Klucz główny</h4> <p> W SQL musimy ustawić jedną kolumnę lub kombinację kolumn jako klucz główny (primary key) który identyfikuje w unikalny sposób dany rekord w danej tablicy. </p> <p> W MongoDB klucz główny automatycznie ustawia się jako pole _id. Zmienna _id to obiekt typu ObjectId. </p> <pre>
            _id: ObjectId('5f15996fbbde793a107af359');
          </pre> <p>Każdy ObjectId() zawiera 12 bajtów, które dzielą się na następujące grupy:</p> <ul class="unnumbered-list-container"> <li> 4 - bajtowa wartość (5f15996f) oznaczająca sekundy, zaczynając od poprzedniego zapisu ObjectId; </li> <li> 3 - bajtowa wartość (bbde79) oznaczająca identyfikator maszyny na której znajduje się baza; </li> <li>2 - bajtowa wartość (3a10) oznaczająca identyfikator procesu MongoDB;</li> <li>3 - bajtowy licznik (7af359), zaczynający się od losowej wartości.</li> </ul> </article> <article id="1.4"> <h2>1.4 MongoDB Atlas</h2> <p> Zamiast instalować naszą bazę danych lokalnie, będziemy wykorzystywać usługę w chmurze <a href="https://www.mongodb.com/products/platform/atlas-database">MongoDB Atlas</a>. </p> <p> MongoDB Atlas to platforma oferująca usługę zarządzanej bazy danych MongoDB w chmurze, z darmowym poziomem klastra bazy. </p> <p>Przejdź rejestrację, najlepiej przez swoje konto Google.</p> <p>Utwórz swój pierwszy klaster - Build a Database</p> <div class="grow_up-img-bigger img-container"> <img src="/HelpCreatingWebsite/17-mongodb-2.bf44debe.png" alt=""> </div> <p>Wybierz darmową opcję M0</p> <div class="grow_up-img-bigger img-container"> <img src="/HelpCreatingWebsite/18-mongoDb-3.7a379816.png" alt=""> </div> <p>W tym samym kroku:</p> <ul class="unnumbered-list-container"> <li>Wybierz providera (nie ma to większego znaczenia na potrzeby naszych ćwiczeń)</li> <li> Wybierz najbliższy dla siebie region geograficzny, dla którego dostępny jest darmowy tier M0. </li> <li>Podaj nazwę klastra (możesz zostawić domyślne Cluster0)</li> </ul> <div class="grow_up-img-bigger img-container"> <img src="/HelpCreatingWebsite/19-mongoDb-4.abec50ec.png" alt=""> </div> <p>Następnie kliknij na Create, jeśli musisz wypełnij Captche</p> <p> W kolejnym kroku musisz podać nazwę użytkownika i hasło które zostanie wykorzystane do połączenia z bazą danych </p> <div class="grow_up-img-bigger img-container"> <img src="/HelpCreatingWebsite/20-mongoDb-5.1aee6a92.png" alt=""> </div> <p> Pamiętaj, żeby skopiować i zapisać hasło, później będziesz musiał je zresetować jeśli je zgubisz </p> <p> Kliknij na Create User i gotowe, teraz powinieneś móc zobaczyć swój klaster na stronie głównej (Deployment → Database w nawigacji bocznej) </p> <div class="grow_up-img-bigger img-container"> <img src="/HelpCreatingWebsite/21-mongoDb-6.9c6cb08a.png" alt=""> </div> <p> Następnym krokiem będzie skonfigurowanie dostępu do bazy, przejdźmy więc do zakładki Security → Network Access </p> <div class="grow_up-img-bigger img-container"> <img src="/HelpCreatingWebsite/22-mongoDb-7.c9427b44.png" alt=""> </div> <p> Tutaj możesz dodać swój adres ip (bądź dowolną ich ilość), lub ewentualnie zezwolić na dostęp z dowolnego dresu ustawiając wartość IP 0.0.0.0/0 (to rozwiązanie nie jest zalecane) </p> <p> Jeśli potrzebujesz utworzyć kolejnego użytkownika dla naszej bazy danych, możesz przejść do zakładki Security → Database Access i kliknąć na Add New Database User. </p> <p> Wybierz jako metodę uwierzytelnienia hasło. Wymyśl nazwę i hasło użytkownika i zapamiętaj je, umieścimy je dalej w zmiennych środowiskowych naszego programu. </p> <p>Ustaw prawa użytkownika na odczytywanie i zapisywanie w dowolnej bazie danych.</p> <div class="grow_up-img-bigger img-container"> <img src="/HelpCreatingWebsite/23-mongoDb-8.4b38c4e6.png" alt=""> </div> <p> Wstępna konfiguracja jest zakończona i teraz można wrócić do zakładki Database. Tutaj wybieramy klikamy w przycisk Connect przy naszym klastrze. </p> <p>W wyskakującym okienku wybieramy Drivers</p> <div class="grow_up-img-bigger img-container"> <img src="/HelpCreatingWebsite/24-mongoDb-9.1de2690d.png" alt=""> </div> <p>Następnie wybieramy odpowiednio Driver Node.js i wersję 4.1 or later</p> <div class="grow_up-img-bigger img-container"> <img src="/HelpCreatingWebsite/25-mongoDb-10.2491af9d.png" alt=""> </div> <p> Jak widzisz w kroku 3 podany jest specjalny string który pozwoli na połączenie się z bazą danych </p> <p>Musimy pamiętać żeby zamienić w nim dwa symbole zastępcze:</p> <ul class="unnumbered-list-container"> <li>&ltusername> - nazwa użytkownika którego stworzyliśmy</li> <li>&ltpassword> - hasło tego użytkownika</li> </ul> <p> Przy pomocy tego stringa (nazywanego SRV) będziemy łączyć się z naszą bazą danych w chmurze. </p> </article> </section>  <section id="2" class="text"> <article id="2.1"> <h2>2.1 MongoDB GUI</h2> <p> Istnieje wiele graficznych narzędzi zarządzania MongoDB. Te programy zwiększają ułatwiają projektowanie i administrowanie bazą danych. Są wygodne i często dostarczają również wewnętrzną konsolę do pracy z bazą danych. Takie oprogramowanie nazywamy też czasem "klientem bazy danych" </p> <p> Przeanalizujemy dwa popularne narzędzia graficzne dla MongoDB i dowiemy się, jak podłączyć się w nich do bazy danych w chmurze. Te dwa narzędzia nie tylko w pełni wystarczą na potrzeby kursu, ale są również zupełnie wystarczające do pracy komercyjnej. </p> </article> <article id="2.2"> <h3> 2.2 MongoDB Compass <a href="https://www.mongodb.com/products/tools/compass">link</a> </h3> <p> Graficzny interfejs dla MongoDB od jego twórców. Dostarcza dobrą wizualizację danych i pełną funkcjonalność CRUD. Dostępny jest dla platform Linux, Mac lub Windows. </p> <p> Podłączenie do bazy danych następuje przy pomocy SRV, otwieramy więc naszego klienta bazy, wklejamy nasze SRV z uzupełnionym hasłem i nazwą użytkownika i klikamy na Save & Connect, a następnie podajemy nazwę i kolor pod którymi chcemy zapisać dane połączenie na później </p> <div class="grow_up-img-bigger img-container"> <img src="/HelpCreatingWebsite/26-mongoDbCompass-1.acbaff0c.png" alt=""> </div> <div class="grow_up-img-bigger img-container"> <img src="/HelpCreatingWebsite/27-mongoDbCompass-2.307dbb2e.png" alt=""> </div> <p>Po połączeniu zobaczymy mniej więcej to:</p> <div class="grow_up-img-bigger img-container"> <img src="/HelpCreatingWebsite/28-mongoDbCompass-3.ae93c1c7.png" alt=""> </div> <p> Po lewej będzie menu z naszymi bazami i kolekcjami, możemy tam utworzyć naszą pierwszą bazę danych. Po wyborze bazy i kolekcji dostaniemy się do panelu zarządzania kolekcją. </p> <div class="grow_up-img-bigger img-container"> <img src="/HelpCreatingWebsite/29-mongoDbCompass-4.29959a32.png" alt=""> </div> <p> Oprócz konsoli dla poleceń MONGOSH, Compass, dostarcza on panelu do wyszukiwania i filtrowania po naszych dokumentach oraz pełną funkcjonalność dla operacji CRUD na dokumentach, bez potrzeby wykorzystania czystego języka zapytań. Compass jest dość prosty ale przez to bywa ograniczony i utrudnia bardziej skomplikowane operacje. </p> </article> <article id="2.3"> <h3>2.3 Robo 3T <a href="https://robomongo.org/">link</a></h3> <p> Popularny, bezpłatny klient MongoDB. To dosyć zaawansowane narzędzie z otwartym kodem źródłowym. Dostępne jest na wielu platformach. Zostało zaprojektowane przez 3T Software, firmę stojącą za Studiem 3T, płatną i bardziej rozbudowana wersją Robo 3T </p> <div class="grow_up-img img-container"> <img src="/HelpCreatingWebsite/30-roboto3T-1.2fc7e3a7.png" alt=""> </div> <p> Przy starcie pojawi się okno pokazujące zapisane połączenia do bazy danych i umożliwiające utworzenie nowego przez przycisk Create (na górze okienka) </p> <div class="grow_up-img img-container"> <img src="/HelpCreatingWebsite/31-roboto3T-2.85704482.png" alt=""> </div> <p> Nasz string SRV możemy wkleić do okienka obok przycisku From URI, który następnie wciskamy, a Robo3T samo odczyta wprowadzone w nim hasło i użytkownika oraz host naszej bazy danych </p> <p> Następnie możemy przetestować nasze połączenie klikając na Test w dolnym lewym rogu okienka, jeśli testy przejdą poprawnie, możemy zapisać nasze połączenie (podaj swoją nazwę w polu Name) </p> <p> Potem z listy naszych połączeń wybieramy to świeżo dodane i zobaczymy następujący interfejs </p> <div class="grow_up-img img-container"> <img src="/HelpCreatingWebsite/32-roboto3T-3.3320eb36.png" alt=""> </div> <p> Jest on nieco podobny do poprzedniego programu, ale zamiast paneli na górze widzimy konsolę w której wprowadzamy zapytania do bazy danych. Na przykład pokazanie zawartości kolekcji dogs to: </p> <pre>
            db.getCollection('dogs').find({});
          </pre> <p> Wykonanie poleceń zachodzi przy pomocy klawisza F5 lub kombinację klawiszy Ctrl+Enter (Command+R dla MacOS). </p> <p>W tym i w następnym module będziemy wykorzystywać Robo3T do pracy z Mongo.</p> </article> </section>  <section id="3" class="text"> <article id="3.1"> <h2>3.1 Podstawowe komendy MongoDB</h2> <p> Po podłączeniu do bazy w chmurze MongoDB kliknij prawym przyciskiem myszy na dowolną bazę w lewym panelu Robo 3T. W menu kontekstowym wybierz Open shell - otworzy się konsola, w której możemy pracować. </p> <p>Pierwsze polecenie to:</p> <pre>
            use test
          </pre> <p>Pamiętaj aby wykonać to polecenie przy użyciu odpowiedniego skrótu klawiszowego</p> <div class="grow_up-img img-container"> <img src="/HelpCreatingWebsite/33-mongoDbKomendy-1.861ffaf3.png" alt=""> </div> <p> Jeżeli chcemy dowiedzieć się, jaka baza danych jest w tym momencie wykorzystywana, możemy użyć polecenia: </p> <pre>
             db
          </pre> <div class="grow_up-img img-container"> <img src="/HelpCreatingWebsite/34-mongoDbKomendy-2.dde0144e.png" alt=""> </div> <p> Wykorzystując polecenie db.stats(), można otrzymać statystykę wybranej bazy danych, możemy też doprecyzować, że chodzi nam tylko o statystyki kolekcji dogs </p> <pre>
            db.dogs.stats();
          </pre> <div class="grow_up-img img-container"> <img src="/HelpCreatingWebsite/35-mongoDbKomendy-3.7cf1a10d.png" alt=""> </div> </article> <article id="3.2"> <h3>3.2 Dodanie dokumentów do kolekcji</h3> <p>Można w tym celu wykorzystać kilka metod, między innymi:</p> <ul class="unnumbered-list-container"> <li>insertOne: dodaje jeden dokument;</li> <li>insertMany: dodaje kilka dokumentów;</li> <li>insert: może dodawać zarówno jeden, jak i więcej dokumentów.</li> </ul> <p> Kliknijmy najpierw na bazę test (rozwijając ja), potem na Collections, a następnie na kolekcję dogs. W konsoli wykonajmy polecenie </p> <pre>
            db.dogs.insertOne({
              name: 'burek',
              age: 3,
              features: ['zjada kapcie', 'pozwala się głaskać', 'rudy'],
            });
          </pre> <p>Otrzymamy rezultat zbliżony do:</p> <pre>
            {
              "acknowledged": true,
              "insertedId": ObjectId("5f837f855ba83a4f1829ca5b")
            }
          </pre> <p> Oznacza on, że podany dokument dodany został do kolekcji dogs. Podwójnym kliknięciem na nazwę dogs kolekcji w lewym menu otwieramy nową zakładkę w konsoli, gdzie automatycznie wykonuje się polecenie. </p> <pre>
            db.getCollection('dogs').find({});
          </pre> <div class="grow_up-img img-container"> <img src="/HelpCreatingWebsite/36-mongoDbKomendy-4.68ced68d.png" alt=""> </div> <p>Istnieje kilka ograniczeń przy tworzeniu nazw kluczy w dokumentach:</p> <ol class="numbered-list-container"> <li>Symbol $ nie może być pierwszym symbolem w nazwie klucza.</li> <li>Nazwa klucza nie może zawierać symbolu kropki .</li> <li> Nazwa _id jako zazwyczaj zarezerwowana nie jest rekomendowana do ręcznego ustawiania. </li> </ol> <p>Dodajmy teraz dwa dokumenty naraz</p> <pre>
            db.dogs.insertMany([
            {
              name: 'Mamba',
              age: 2,
              features: ['poluje na samochody', 'szczerzy zęby', 'czarna'],
            },
            {
              name: 'Pirat',
              age: 4,
              features: ['ma tylko jedno oko', 'pozwala się głaskać', 'kudłaty'],
            },
          ]);
          </pre> <p> Rezultat odpowiedzi będzie podobny do tego - zwrócono nam dwa unikalne identyfikatory w ponownie utworzonych dokumentach: </p> <pre>
            {
              "acknowledged": true,
              "insertedIds": [
                ObjectId("5f837f895ba83a4f1829ca5c"),
                ObjectId("5f837f895ba83a4f1829ca5d")
              ]
            }
          </pre> <p>Moglibyśmy też wykonać podobne polecenie przy użyciu komendy insert</p> <pre>
            db.dogs.insert([
              {
                name: 'Azor',
                age: 10,
                features: ['świszczy'],
              },
              {
                name: 'Kajtek',
                age: 15,
                features: ['zjada trawę', 'poluje na Azora'],
              },
            ]);
          </pre> <p>Po tym działaniu w naszej kolekcji powinno znajdować się pięć dokumentów</p> <div class="grow_up-img img-container"> <img src="/HelpCreatingWebsite/37-mongoDbKomendy-5.704253ec.png" alt=""> </div> </article> <article id="3.3"> <h3>3.3 Szukanie w zbiorze</h3> <p>Dla odnalezienia dokumentów wykorzystuje się metodę find:</p> <pre>
            db.dogs.find();
          </pre> <p>Wynikiem tego działania powinno być coś podobnego (twoje _id będą odmienne) do:</p> <pre>
            /* 1 */
            {
                "_id" : ObjectId("64596ed4e50efc2ba61c4bee"),
                "name" : "burek",
                "age" : 3.0,
                "features" : [
                    "zjada kapcie",
                    "pozwala się głaskać",
                    "rudy"
                ]
            }

            /* 2 */
            {
                "_id" : ObjectId("64596f84e50efc2ba61c4bef"),
                "name" : "Mamba",
                "age" : 2.0,
                "features" : [
                    "poluje na samochody",
                    "szczerzy zęby",
                    "czarna"
                ]
            }

            /* 3 */
            {
                "_id" : ObjectId("64596f84e50efc2ba61c4bf0"),
                "name" : "Pirat",
                "age" : 4.0,
                "features" : [
                    "ma tylko jedno oko",
                    "pozwala się głaskać",
                    "kudłaty"
                ]
            }

            /* 4 */
            {
                "_id" : ObjectId("64597065e50efc2ba61c4bf3"),
                "name" : "Azor",
                "age" : 10.0,
                "features" : [
                    "świszczy"
                ]
            }

            /* 5 */
            {
                "_id" : ObjectId("64597065e50efc2ba61c4bf4"),
                "name" : "Kajtek",
                "age" : 15.0,
                "features" : [
                    "zjada trawę",
                    "poluje na Azora"
                ]
            }
          </pre> <p> W MongoDB w zapytaniach można wykorzystać między innymi następujące konstrukcje przy pomocy operatorów porównania: </p> <ul class="unnumbered-list-container"> <li>$eq (równo)</li> <li>$gt (więcej niż)</li> <li>$lt (mniej niż)</li> <li>$gte (więcej lub równo)</li> <li>$lte (mniej lub równo)</li> </ul> <pre>
            db.dogs.find({ age: { $lte: 5 }, features: 'pozwala się głaskać' });
          </pre> <p>Wynik:</p> <pre>
            /* 1 */
            {
                "_id" : ObjectId("64596ed4e50efc2ba61c4bee"),
                "name" : "burek",
                "age" : 3.0,
                "features" : [
                    "zjada kapcie",
                    "pozwala się głaskać",
                    "rudy"
                ]
            }

            /* 2 */
            {
                "_id" : ObjectId("64596f84e50efc2ba61c4bf0"),
                "name" : "Pirat",
                "age" : 4.0,
                "features" : [
                    "ma tylko jedno oko",
                    "pozwala się głaskać",
                    "kudłaty"
                ]
            }
          </pre> </article> <article id="3.4"> <h3>3.4 Project</h3> <p> Zdarza się, że potrzebujemy tylko niektóre pola z odnalezionych dokumentów, lub chcemy niektóre z nich ominąć z wyników, możemy do tego użyć konstrukcji projekcji w następujący sposób: </p> <pre>
            db.dogs.find({ age: { $lte: 5 }, features: 'pozwala się głaskać' }, { name: 0 });
          </pre> <p> Jako drugi argument metody find podaliśmy obiekt project który usunął z wyników wyszukiwania pole name (dotyczy to tylko aktualnych wyników wyszukiwania, nie wpływa to w żaden sposób na oryginalne dokumenty) </p> <pre>
            /* 1 */
            {
                "_id" : ObjectId("64596ed4e50efc2ba61c4bee"),
                "age" : 3.0,
                "features" : [
                    "zjada kapcie",
                    "pozwala się głaskać",
                    "rudy"
                ]
            }

            /* 2 */
            {
                "_id" : ObjectId("64596f84e50efc2ba61c4bf0"),
                "age" : 4.0,
                "features" : [
                    "ma tylko jedno oko",
                    "pozwala się głaskać",
                    "kudłaty"
                ]
            }
          </pre> <p>Użyjmy teraz tego obiektu odwrotnie, czyli zostawimy tylko dwa niezbędne pola:</p> <pre>
            db.dogs.find(
              { age: { $lte: 5 }, features: 'pozwala się głaskać' },
              { name: 1, age: 1 }
            );
          </pre> <p>Wynik:</p> <pre>
            /* 1 */
            {
                "_id" : ObjectId("64596ed4e50efc2ba61c4bee"),
                "name" : "burek",
                "age" : 3.0
            }

            /* 2 */
            {
                "_id" : ObjectId("64596f84e50efc2ba61c4bf0"),
                "name" : "Pirat",
                "age" : 4.0
            }
          </pre> <p> Trzeba wspomnieć, że pole _id domyślnie zawsze jest zwracane, chyba, że celowo je ominiemy poprzez właściwość w obiekcie projekcji: _id: 0. </p> </article> <article id="3.5"> <h3>3.5 Zapytania o zagnieżdżone właściwości obiektów</h3> <p>Wstawmy nowy dokument z właściwością owner o wartości obiektu:</p> <pre>
            db.dogs.insert({
              name: 'Klusia',
              age: 10,
              features: ['w kształcie kadłuba', 'szara'],
              owner: { name: 'Jola', age: 27, address: 'Kraków' },
            });
          </pre> <p> Aby wyszukiwać zgodnie z wartością zagnieżdżonej wartości, trzeba użyć kropki i cudzysłowiu: 'owner.name': </p> <pre>
            db.dogs.find({ 'owner.name': 'Jola' });
          </pre> <p>Wynik:</p> <pre>
            {
              "_id" : ObjectId("64597228e50efc2ba61c4bf6"),
              "name" : "Klusia",
              "age" : 10.0,
              "features" : [
                  "w kształcie kadłuba",
                  "szara"
              ],
              "owner" : {
                  "name" : "Jola",
                  "age" : 27.0,
                  "address" : "Kraków"
              }
          }
          </pre> </article> <article id="3.6"> <h3>3.6 Dodatkowa konfiguracja zapytań:</h3> <p> Aby ograniczyć ilość zwróconych wyników, wykorzystuje się funkcję limit. Na przykład aby pokazać pierwsze trzy dokumenty w kolekcji wywołamy ją tak: </p> <pre>
            db.dogs.find().limit(3);
          </pre> <p> Aby ominąć jakąś ilość dokumentów w wyborze, wykorzystuje się funkcję skip. Na przykład aby ominąć pierwsze trzy dokumenty w wyborze: </p> <pre>
            db.dogs.find().skip(3);
          </pre> <p> Sortowanie wyników wykonuje się poprzez funkcję sort, która przyjmuje obiekt z polami służącymi do sortowania, dla których podajemy kierunek poprzez wartości </p> <ul class="unnumbered-list-container"> <li>1 rosnąco,</li> <li>-1 malejąco</li> </ul> <p>Na przykład posortujmy wyniki po polu name rosnąco (w tym przypadku alfabetycznie)</p> <pre>
            db.dogs.find().sort({ name: 1 });
          </pre> <p> Przy pomocy funkcji count() możemy otrzymać ilość elementów w kolekcji (możemy też doprecyzować filtr w argumencie metody tak jak przy find()) </p> <pre>
            db.dogs.count();
          </pre> <p>Wynik: 6</p> <p> Operator $exists pozwala wyciągnąć tylko te dokumenty, w których określony klucz istnieje lub nie. </p> <pre>
            db.dogs.find({ owner: { $exists: true } }); // klucz owner istnieje
            db.dogs.find({ owner: { $exists: false } }); // klucz owner nie istnieje
          </pre> <p> Operator $type odflitruje tylko te dokumenty, w których określony klucz ma wartość podanego typu, na przykład string lub number: </p> <pre>
            db.dogs.find({ age: { $type: 'number' } });
          </pre> <p> Operator $regex przyjmuje regularne wyrażenie, które musi spełnić wartość danego pola w dokumencie </p> <pre>
            db.dogs.find({ name: { $regex: 'A' } });
          </pre> <p>Wynik:</p> <pre>
            /* 1 */
            {
                "_id" : ObjectId("64597065e50efc2ba61c4bf3"),
                "name" : "Azor",
                "age" : 10.0,
                "features" : [
                    "świszczy"
                ]
            }
          </pre> <p> Operator logiczny lub - $or, pozwala wybrać dokumenty spełniające przynajmniej jeden z warunków: </p> <pre>
            db.dogs.find({ $or: [{ name: { $regex: 'A' } }, { age: { $lte: 3 } }] });
          </pre> <p>Wynik:</p> <pre>
            /* 1 */
            {
                "_id" : ObjectId("64596ed4e50efc2ba61c4bee"),
                "name" : "burek",
                "age" : 3.0,
                "features" : [
                    "zjada kapcie",
                    "pozwala się głaskać",
                    "rudy"
                ]
            }

            /* 2 */
            {
                "_id" : ObjectId("64596f84e50efc2ba61c4bef"),
                "name" : "Mamba",
                "age" : 2.0,
                "features" : [
                    "poluje na samochody",
                    "szczerzy zęby",
                    "czarna"
                ]
            }

            /* 3 */
            {
                "_id" : ObjectId("64597065e50efc2ba61c4bf3"),
                "name" : "Azor",
                "age" : 10.0,
                "features" : [
                    "świszczy"
                ]
            }
          </pre> <p> Operator iloczynu logicznego $and, zwróci tylko te dokumenty które spełniają wszystkie warunki </p> <pre>
            db.dogs.find({ $and: [{ name: { $regex: '.*a.*' } }, { age: { $lte: 10 } }] });
          </pre> <p>Wynik:</p> <pre>
            /* 1 */
            {
                "_id" : ObjectId("64596f84e50efc2ba61c4bef"),
                "name" : "Mamba",
                "age" : 2.0,
                "features" : [
                    "poluje na samochody",
                    "szczerzy zęby",
                    "czarna"
                ]
            }

            /* 2 */
            {
                "_id" : ObjectId("64596f84e50efc2ba61c4bf0"),
                "name" : "Pirat",
                "age" : 4.0,
                "features" : [
                    "ma tylko jedno oko",
                    "pozwala się głaskać",
                    "kudłaty"
                ]
            }

            /* 3 */
            {
                "_id" : ObjectId("64597228e50efc2ba61c4bf5"),
                "name" : "Klusia",
                "age" : 10.0,
                "features" : [
                    "w kształcie kadłuba",
                    "szara"
                ],
                "owner" : {
                    "name" : "Jola",
                    "age" : 27.0,
                    "address" : "Kraków"
                }
            }
          </pre> </article> <article id="3.7"> <h3>3.7 Kursory</h3> <p> Wynik zapytania, otrzymany przy pomocy funkcji find, nazywany jest kursorem. Kursory zawierają w sobie zbiór otrzymanych z bazy danych dokumentów. </p> <p> Wykorzystując składnię języka JavaScript i metodę kursora, możemy po kolei pracować na otrzymanych dokumentach </p> <pre>
            const cursor = db.dogs.find();
              while (cursor.hasNext()) {
                obj = cursor.next();
                print(obj['name']);
              }
          </pre> <p>Wynik:</p> <pre>
            burek
            Mamba
            Pirat
            Azor
            Kajtek
            Klusia
          </pre> </article> <article id="3.8"> <h3>3.8 Zapisywanie dokumentów</h3> <p>Zapisywanie dokumentów możemy osiągnąć też metodą save.</p> <p> W nowym dokumencie jako pole można przekazać parametr _id. Jeżeli metoda znajduje dokument z taką wartością _id, to dokument zaktualizuje się. Jeżeli jednak nie ma dokumentów z podanym _id to nowy dokument jest tworzony. </p> <pre>
            db.dogs.save({ name: 'Bars', age: 3 });
          </pre> </article> <article id="3.9"> <h3>3.9 Aktualizacja dokumentów</h3> <p> Więcej opcji dla aktualizacji dokumentu oferuje funkcja updateOne (i jej podobna konstrukcja updateMany która może aktualizować wiele elementów. Przyjmuje ona trzy parametry: </p> <ol class="numbered-list-container"> <li>filter: filtr który odnajduje dokument który chcemy zmodyfikować</li> <li>update: określa w jaki sposób chcemy zmodyfikować dokument</li> <li> options: określa dodatkowe parametry dla aktualizacji dokumentów, między innymi upsert. </li> </ol> <p> Jeżeli parametr upsert ma wartość true, to MongoDB będzie aktualizować dokument, jeśli zostanie on znaleziony lub stworzy nowy, jeżeli takiego dokumentu nie ma. </p> <p> Jeżeli jednak przyjmuje on wartość false, to MongoDB nie będzie tworzyć nowego dokumentu w przypadku, w którym filter nie znajdzie żadnego pasującego dokumentu. </p> <p> Poniższa operacja zaktualizuje dokument w którym klucz name ma wartość Bars, nada mu wartości z obiektu update.$set. Z uwagi na flagę upsert, jeśli nie odnajdziemy dokumentu po filter, zostanie on utworzony przed aktualizacją. </p> <pre>
            db.dogs.updateOne(
                { name: 'Bars' },
                { $set: { name: 'Tom', age: 5 } },
                { upsert: true }
            );
          </pre> <p>Jeśli chcemy zaktualizować wiele dokumentów, użyjemy metody updateMany</p> <p>Dla usunięcia klucza wykorzystuje się operator $unset:</p> <p> UWAGA: jeśli zastosujemy metodę updateOne, a elementów pasujących do filter jest więcej niż jeden, to zaktualizowany zostanie tylko pierwszy z nich. </p> </article> <article id="3.10"> <h3>3.10 Usunięcie dokumentu</h3> <p> Do usunięcia dokumentów w MongoDB przewidziana jest metoda deleteOne lub deleteMany: </p> <p>Usunięcie wszystkich dokumentów pasujących do danego filtra</p> <pre>
            db.dogs.deleteMany({ name: 'Tom' });
          </pre> <p>Analogicznie jeżeli chcemy usunąć tylko jeden dokument:</p> <pre>
            db.dogs.deleteOne({ name: 'Tom' });
          </pre> </article> </section> </main> <footer class="footer"> <div class="footer-logo"> <img src="/HelpCreatingWebsite/konikMaly24x24Squoosh.989f9831.png" alt="logoImage" width="24"> <img src="/HelpCreatingWebsite/3KLogo.b575da86.png" alt="logoText"> </div> <div id="footer-title"> <p></p> </div> <div class="footer-date"> <p>19.09.2024r.</p> </div> </footer>  <script defer src="/HelpCreatingWebsite/htmlNode/01-podstawyNode.js.e00d2eb0.js"></script> </body></html>